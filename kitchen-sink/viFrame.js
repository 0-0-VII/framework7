/*! vi HTML SDK - v1.0.0 */
"use strict";!function(a,b,c){function d(){p=b.getElementById("ps")}function e(a){var b=a.tracking,c=!1,d=!1;if(a&&a.media_content)for(var e=a.media_content,f=0;f<e.length;f++)if("video"===e[f].type&&"video/mp4"===e[f].mime_type){c=!0;break}if(b)for(var g in b)if(b.hasOwnProperty(g)){if("[object Array]"===Object.prototype.toString.call(b[g])&&b[g].length>0){d=!0;break}if("playback"===g&&b.playback&&b.playback.percentage&&(b.playback.percentage[25]&&b.playback.percentage[25].length>0||b.playback.percentage[50]&&b.playback.percentage[50].length>0||b.playback.percentage[75]&&b.playback.percentage[75].length>0)){d=!0;break}}return c&&d}function f(a){var b=null;if(a&&a.media_content)for(var c,d=a.media_content,e=1e4,f=0;f<d.length;f++)if(c=d[f],"video"===c.type&&"video/mp4"===c.mime_type){if(!c.bitrate){b=c.content_url;break}Math.abs(c.bitrate-800)<e&&(e=Math.abs(c.bitrate-800),b=c.content_url)}return b}function g(){var a=o?parseInt(o.currentTime):0;isNaN(a)&&(a=0);var b=o?parseInt(o.duration):0;isNaN(b)&&(b=0);var c=100*a/b|0;p&&(p.style.width=c+"%"),!q&&c>=25&&(q=!0,i("25"),h("AdVideoFirstQuartile")),!r&&c>=50&&(r=!0,i("50"),h("AdVideoMidpoint")),!s&&c>=75&&(s=!0,i("75"),h("AdVideoThirdQuartile"))}function h(a,b){if(a&&u){var c=u[a];b||(b=[]),c&&c.func.apply(c.ctx,b)}}function i(a){var b=w.length>0&&w[0].tracking;if(b){var c,d,e=[];if(b[a]?e=b[a]:-1!==["25","50","75"].indexOf(a)&&(e=b.playback&&b.playback.percentage&&b.playback.percentage[a]),e&&e.length>0)for(h("AdLog",["-> Track event: "+a+" / urls: "+e.length,2]),c=0,d=e.length;c<d;c++)j(e[c],a)}}function j(a,b){var c=new Image(1,1),d=a+"&cbbb="+Math.floor(1e16*Math.random());G.push(d),c.onload=function(){c.onload=null;var a=G.indexOf(d);a>-1&&G.splice(a,1)},c.onerror=function(){c.onerror=null;var a=G.indexOf(d);a>-1&&G.splice(a,1)},c.src=d}function k(a){var c,d=o?parseInt(o.currentTime):0,e="timeupdate"===a.type?3:2;switch(h("AdLog",["---\x3e event: "+a.type+" / time = "+d,e]),a.type){case"loadstart":clearTimeout(A),A=setTimeout(function(){clearTimeout(A),A=null,i("error"),c=u&&u.AdError,c&&c.func&&F.push({func:c.func,ctx:c.ctx,args:["Ad load timeout",0]}),m()},B);break;case"loadedmetadata":break;case"playing":1===x?(clearTimeout(A),A=null,x=0,i("start"),h("AdStarted"),h("AdVideoStart"),i("impression"),h("AdImpression")):3===x&&(i("resume"),h("AdPlaying"));break;case"pause":2===x&&(x=0,i("pause"),h("AdPaused"));break;case"ended":if(4!==x&&(x=0,t=!0,i("complete"),h("AdVideoComplete")),w.length>1){w.splice(0,1),x=1;var j=f(w[0]);q=r=s=t=null,h("AdLog",["-> startAd (next in queue): url = "+j,2]);var k=b.createElement("source");for(k.setAttribute("type","video/mp4"),k.setAttribute("src",j);o.firstChild;)o.removeChild(o.firstChild);o.appendChild(k),o.load(),o.play()}else c=u&&u.AdStopped,c&&c.func&&F.push({func:c.func,ctx:c.ctx,args:["complete"]}),m();break;case"error":i("error"),c=u&&u.AdError,c&&c.func&&F.push({func:c.func,ctx:c.ctx,args:[""+(o&&o.error?o.error.code:o.error),0]}),m();break;case"play":break;case"timeupdate":g()}}function l(a,b,c,d,e){var f,g,i=I.pop()||new XMLHttpRequest,j=b.split("?")[0];i.onreadystatechange=function(){if(4==this.readyState){if(this.onreadystatechange=null,g=H[j].indexOf(this),g>-1&&H[j].splice(g,1),-1===I.indexOf(this)&&I.push(this),clearTimeout(y),y=null,!0===this.aborted)delete this.aborted;else if(200===this.status||204===this.status||404===this.status||0===this.status){f=[];try{f=JSON.parse(this.response||"[]")}catch(c){h("AdError",[a+" status = "+this.status+" / url = "+b+" / JSON.parse error = "+c+" / "+this.response.substr(0,99),0])}d(f)}else e(a+" status = "+this.status+" "+this.statusText+" / "+this.responseText);i=null}},i.hasOwnProperty("timeout")&&(i.timeout=z),y=setTimeout(function(){clearTimeout(y),y=null,h("AdLog",["Ad request timeout ... giving up",1]),m()},z);try{!H[j]&&(H[j]=[]),-1===H[j].indexOf(i)&&H[j].push(i),i.open(a,b,!0),i.setRequestHeader("Accept","application/json"),i.setRequestHeader("Content-Type","application/json"),i.send(c)}catch(c){h("AdError",[a+" failed / url="+b+" / error: "+c,0]),g=H[j].indexOf(i),g>-1&&H[j].splice(g,1),-1===I.indexOf(i)&&I.push(i),i=null}}function m(){clearTimeout(C),C=null,G.length>0?E>0?(h("AdLog",["Pending track URL requests: "+G.length+" ... waiting",1]),E--,C=setTimeout(m,D)):(h("AdLog",["Pending track URL requests: "+G.length+" ... giving up",1]),n()):(E<3&&h("AdLog",["Pending track URL requests: "+G.length+" ... all done",1]),n())}function n(){var a,c,d,e,f;["loadstart","loadedmetadata","playing","pause","ended","seeking","seeked","error","play","timeupdate"].forEach(function(a){o.removeEventListener(a,k,!1)}),v&&(b.removeEventListener("click",v,!1),v=null),clearTimeout(y),y=null,clearTimeout(A),A=null,clearTimeout(C),C=null;for(d in H)if(H.hasOwnProperty(d))for(e=H[d],a=e.length-1;a>=0;a--)f=e[a],f.aborted=!0,f.abort(),e.splice(a,1);for(o=p=null,G=[],H={},x=0,q=r=s=t=null,w=[],a=0;a<F.length;a++)c=F[a],c.func.apply(c.ctx,c.args);F=[]}var o,p,q,r,s,t,u={},v=null,w=[],x=0,y=null,z=2e4,A=null,B=5e3,C=null,D=300,E=3,F=[],G=[],H={},I=[];a.getVPAIDAd=function(){return new d},d.prototype.handshakeVersion=function(a){return"2.0"},d.prototype.initAd=function(c,d,f,g,j,m){m&&m.videoSlot&&m.VI_PLACEMENT_ID&&m.VI_APP_ID&&m.VI_APP_VER||h("AdError",["initAd: Invalid parameters",0]);var n={placement_id:m.VI_PLACEMENT_ID,app:{bundle_id:m.VI_APP_ID,version:m.VI_APP_VER},sdk:{type:"vi_android",version:"1.0"},device:{user_agent:a.navigator.userAgent.toString(),os:m.VI_OS||"not_recognized"},user:{},geo:{}};o=m.videoSlot,m.VI_STORE_ID&&(n.device.storeId=m.VI_STORE_ID),m.VI_IP&&(n.device.ip=m.VI_IP),m.VI_MANUFACTURER&&(n.device.manufacturer=m.VI_MANUFACTURER),m.VI_MODEL&&(n.device.model=m.VI_MODEL),m.VI_CON_TYPE&&(n.device.connection_type=m.VI_CON_TYPE),m.VI_CON_PROVIDER&&(n.device.connection_provider=m.VI_CON_PROVIDER),m.VI_LANG&&(n.device.language=m.VI_LANG),m.VI_WIDTH&&(n.device.width=m.VI_WIDTH),m.VI_HEIGHT&&(n.device.height=m.VI_HEIGHT),m.VI_OS_VERSION&&(n.device.os_version=m.VI_OS_VERSION),m.VI_ORIENTATION&&(n.device.orientation=m.VI_ORIENTATION),m.VI_AGE&&(n.device.user.age=m.VI_AGE),m.VI_GENDER&&(n.device.user.gender=m.VI_GENDER),m.VI_ADVERTISER_ID&&(n.device.user.advertiser_id=m.VI_ADVERTISER_ID),m.VI_LAT&&(n.device.geo.latitude=m.VI_LAT),m.VI_LONG&&(n.device.geo.longitude=m.VI_LONG),m.VI_ACCURACY&&(n.device.geo.accurancy=m.VI_ACCURACY),["loadstart","loadedmetadata","playing","pause","ended","seeking","seeked","error","play","timeupdate"].forEach(function(a){o.addEventListener(a,k,!1)});var p=this;v=function(b){var c=b&&b.target;if(c)if("sb"===c.id)p.stopAd();else{i("click"),h("AdClickThru");var d=w.length>0&&w[0].click_url;d&&a.open(d,"targetWindow")}},b.addEventListener("click",v,!1),l("POST","https://appserver.vidint.net/api/v1/ads/sdk/video",JSON.stringify(n),function(a){if("OK"===a.status){var b,f,g,i,j=a.data&&a.data.playlist&&a.data.playlist.sequence||[],k=a.data&&a.data.playlist&&a.data.playlist.reserved||[],l=[],m=[],n=a.data&&a.data.ads;for(b=0;b<j.length;b++)-1===l.indexOf(j[b])&&l.push(j[b]);for(b=0;b<k.length;b++)-1===m.indexOf(k[b])&&-1===l.indexOf(k[b])&&m.push(k[b]);for(b=0;b<l.length;b++){for(i=!1,f=0;f<n.length;f++)if(n[f].ad_id===l[b]&&e(n[f])){i=!0;break}if(i)w.push(n[f]);else if(m.length>0)for(g=0;g<m.length;g++){for(f=0;f<n.length;f++)if(n[f].ad_id===m[g]&&e(n[f])){i=!0;break}if(i){w.push(n[f]),m.splice(g,1);break}}}if(0===w.length)for(b=0;b<m.length;b++)for(f=0;f<n.length;f++)if(n[f].ad_id===m[b]&&e(n[f])&&0===w.length){w.push(n[f]);break}w.length>0?(o.setAttribute("type","video/mp4"),c&&(o.width=c),d&&(o.height=d),h("AdLoaded")):h("AdError",["Ad is not valid",0])}else"ERROR"===a.status?a.error&&a.error.code&&h("AdError",["Server response: "+a.error.code,0]):h("AdError",["Server response status: "+a.status,0])},function(a){h("AdError",[a,0])})},d.prototype.startAd=function(){if(w.length>0){x=1;var a=f(w[0]);h("AdLog",["-> startAd: url = "+a,2]);var c=b.createElement("source");for(c.setAttribute("type","video/mp4"),c.setAttribute("src",a);o.firstChild;)o.removeChild(o.firstChild);o.appendChild(c),o.load();var d=o.play();void 0!==d&&d.then(function(){}).catch(function(a){B=6e4,h("AdAutoPlayFailed",[a,o])})}},d.prototype.pauseAd=function(){x=2,o&&o.pause()},d.prototype.resumeAd=function(){x=3,o&&o.play()},d.prototype.stopAd=function(){o&&(x=4,o.pause(),o.duration&&o.readyState>0&&(o.currentTime=0));var a=u&&u.AdStopped;a&&a.func&&F.push({func:a.func,ctx:a.ctx,args:["userexit"]}),m()},d.prototype.subscribe=function(a,b,c){a&&b&&u&&(u[b]={func:a,ctx:c})},d.prototype.unsubscribe=function(a){a&&u&&u[a]&&delete u[a]}}(window,window.document);
//# sourceMappingURL=viFrame.min.js.map